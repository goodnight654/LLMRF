# LLMRF é¡¹ç›®æ–‡æ¡£

**ADS è‡ªåŠ¨åŒ–ä»¿çœŸç³»ç»Ÿ**

ç‰ˆæœ¬ï¼š2.0  
æœ€åæ›´æ–°ï¼š2026-02-02

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
adsapi/
â”œâ”€â”€ config.json          # é…ç½®æ–‡ä»¶ï¼ˆå”¯ä¸€éœ€è¦ä¿®æ”¹ï¼‰
â”œâ”€â”€ main.py             # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ ads_engine.py       # ADS ä»¿çœŸå¼•æ“
â”œâ”€â”€ netlist_parser.py   # ç½‘è¡¨è§£æå™¨
â”œâ”€â”€ visualizer.py       # ç»“æœå¯è§†åŒ–
â”œâ”€â”€ llm_interface.py    # LLM æ¥å£
â”œâ”€â”€ run_simple.py       # ç®€åŒ–å¯åŠ¨å™¨
â”œâ”€â”€ check_config.py     # é…ç½®æ£€æŸ¥å·¥å…·
â””â”€â”€ é¡¹ç›®æ–‡æ¡£.md         # æœ¬æ–‡ä»¶
```

---

##  å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ï¼ˆåªéœ€ä¸€æ¬¡ï¼‰

ç¼–è¾‘ `config.json`ï¼š

```json
{
  "ads": {
    "install_path": "F:/Program Files (x86)/ADS2026",
    "python_exe": "F:/Program Files (x86)/ADS2026/tools/python/python.exe"
  }
}
```

**æ£€æŸ¥é…ç½®**ï¼š
```cmd
"F:/Program Files (x86)/ADS2026/tools/python/python.exe" check_config.py
```

### 2. è¿è¡Œä»¿çœŸ

**æ–¹å¼ 1ï¼šä½¿ç”¨å¯åŠ¨å™¨ï¼ˆæ¨èï¼‰**
```cmd
"F:/Program Files (x86)/ADS2026/tools/python/python.exe" run_simple.py
```

**æ–¹å¼ 2ï¼šç›´æ¥å‘½ä»¤è¡Œ**
```cmd
"F:/Program Files (x86)/ADS2026/tools/python/python.exe" main.py --auto
```

**æ–¹å¼ 3ï¼šæŒ‡å®šå·¥ä½œç©ºé—´**
```cmd
"F:/Program Files (x86)/ADS2026/tools/python/python.exe" main.py ^
  --workspace "D:\Desktop\test_wrk" ^
  --library "test_lib" ^
  --design "test"
```

---

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½

### 1. ADS ä»¿çœŸå¼•æ“ (`ads_engine.py`)

**åŠŸèƒ½**ï¼š
- è¿æ¥ ADS å·¥ä½œç©ºé—´å’Œè®¾è®¡
- ç”Ÿæˆå’Œä¿®æ”¹ç½‘è¡¨
- è¿è¡Œä»¿çœŸï¼ˆä½¿ç”¨ CircuitSimulatorï¼‰
- æå–ç»“æœæ•°æ®ï¼ˆ.ds æ–‡ä»¶ â†’ DataFrameï¼‰

**å…³é”®æ–¹æ³•**ï¼š
```python
from ads_engine import ADSEngine

engine = ADSEngine()
engine.connect(workspace, library, design)
ds_path, results = engine.run_simulation()
```

**è¿”å›æ ¼å¼**ï¼š
```python
results = {
    'SP1.SP': DataFrame(...),  # S å‚æ•°æ•°æ®
    'Meas1': DataFrame(...)     # æµ‹é‡æ–¹ç¨‹æ•°æ®
}
```

### 2. ç½‘è¡¨è§£æå™¨ (`netlist_parser.py`)

**åŠŸèƒ½**ï¼š
- è§£æ opt/tune å˜é‡
- æå–å‚æ•°èŒƒå›´

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from netlist_parser import NetlistParser

variables = NetlistParser.parse_from_file("design.net")
print(NetlistParser.format_variable_table(variables))
```

### 3. ç»“æœå¯è§†åŒ– (`visualizer.py`)

**åŠŸèƒ½**ï¼š
- S å‚æ•°æ›²çº¿å›¾
- Smith åœ†å›¾
- ä» DataFrame ç›´æ¥ç»˜å›¾

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from visualizer import ResultVisualizer

viz = ResultVisualizer(output_dir="./results/plots")
viz.plot_from_dataframe(df, freq_col='freq', 
                       data_cols=['S[1,1]', 'S[2,1]'])
```

### 4. LLM æ¥å£ (`llm_interface.py`)

**åŠŸèƒ½**ï¼š
- å‚æ•°å»ºè®®
- ä¼˜åŒ–ç­–ç•¥
- ç»“æœåˆ†æ

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from llm_interface import LLMInterface

llm = LLMInterface(api_url="http://localhost:11434/api/generate")
suggestions = llm.suggest_initial_parameters(design_spec, variables)
```

---

## ğŸ”§ å·¥ä½œæµç¨‹

```
1. è¿æ¥ ADS
   â†“
2. åŠ è½½è®¾è®¡ â†’ ç”Ÿæˆç½‘è¡¨ â†’ è§£æå˜é‡
   â†“
3. è¿è¡Œä»¿çœŸ â†’ ä½¿ç”¨ CircuitSimulator
   â†“
4. æå–ç»“æœ â†’ .ds æ–‡ä»¶ â†’ DataFrame
   â†“
5. ç»˜åˆ¶å›¾è¡¨ â†’ ä¿å­˜ PNG
```

---

## ğŸ“Š ä»¿çœŸç»“æœ

**è¾“å‡ºç›®å½•**ï¼š`./results/`

```
results/
â”œâ”€â”€ design.net                  # ç½‘è¡¨æ–‡ä»¶
â”œâ”€â”€ variables.json              # å¯è°ƒå˜é‡
â”œâ”€â”€ baseline_results.json       # ä»¿çœŸç»“æœå…ƒæ•°æ®
â””â”€â”€ plots/                      # å›¾è¡¨
    â”œâ”€â”€ s_params_SP1.SP.png    # S å‚æ•°å›¾
    â””â”€â”€ measurements_*.png      # æµ‹é‡å€¼å›¾
```

**ç»“æœæ•°æ®æ ¼å¼**ï¼š
```python
# DataFrame ç¤ºä¾‹
df.columns = ['freq', 'S[1,1]', 'S[2,1]', 'groupdelay', ...]
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### config.json å®Œæ•´é…ç½®

```json
{
  "_comment": "LLMRF é…ç½®æ–‡ä»¶",
  
  "ads": {
    "_comment": "ADS å®‰è£…è·¯å¾„",
    "install_path": "F:/Program Files (x86)/ADS2026",
    "python_exe": "F:/Program Files (x86)/ADS2026/tools/python/python.exe"
  },
  
  "project": {
    "_comment": "é¡¹ç›®ä¿¡æ¯ï¼ˆç•™ç©º=è‡ªåŠ¨æ£€æµ‹ï¼‰",
    "workspace": "",
    "library": "",
    "design": ""
  },
  
  "llm": {
    "_comment": "LLM é…ç½®",
    "enabled": false,
    "api_url": "http://localhost:11434/api/generate",
    "model": "qwen2.5:14b"
  },
  
  "output": {
    "_comment": "è¾“å‡ºè®¾ç½®",
    "dir": "./results",
    "save_plots": true
  }
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å¯¼å…¥é”™è¯¯ - `keysight.ads.dds` å¿…é¡»å…ˆå¯¼å…¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
RuntimeError: "keysight.ads.dataset" cannot be imported without first importing "keysight.ads.dds"
```

**è§£å†³**ï¼šå·²ä¿®å¤ï¼Œå¯¼å…¥é¡ºåºä¸ºï¼š
```python
from keysight.ads import dds      # å…ˆå¯¼å…¥ dds
from keysight.ads import dataset  # å†å¯¼å…¥ dataset
```

### Q2: HPEESOF_DIR è·¯å¾„é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
RuntimeError: HPEESOF_DIR is set to "..." but this path is not a directory
```

**è§£å†³**ï¼š
1. è¿è¡Œ `check_config.py`
2. ä¿®æ­£ `config.json` ä¸­çš„ `install_path`
3. ä½¿ç”¨ `/` è€Œä¸æ˜¯ `\`

### Q3: æ²¡æœ‰ç”Ÿæˆå›¾è¡¨

**åŸå› **ï¼šå¯èƒ½ç¼ºå°‘ä»¿çœŸæ•°æ®æˆ–æµ‹é‡æ–¹ç¨‹

**è§£å†³**ï¼š
1. åœ¨ ADS è®¾è®¡ä¸­æ·»åŠ  S_Param æ§åˆ¶å™¨
2. æ·»åŠ  MeasEqn è¿›è¡Œæ•°æ®æµ‹é‡
3. å‚è€ƒ `4.py` ç¤ºä¾‹

### Q4: ä»¿çœŸæ— ç»“æœ

**æ£€æŸ¥**ï¼š
1. è®¾è®¡æ˜¯å¦æœ‰æ•ˆï¼Ÿ
2. ä»¿çœŸæ§åˆ¶å™¨æ˜¯å¦é…ç½®ï¼Ÿ
3. æŸ¥çœ‹ `sim_output_*/` ç›®å½•æ—¥å¿—

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### å®Œæ•´ä½¿ç”¨æµç¨‹

```python
import os
os.environ['HPEESOF_DIR'] = "F:/Program Files (x86)/ADS2026"

from ads_engine import ADSEngine
from netlist_parser import NetlistParser
from visualizer import ResultVisualizer

# 1. åˆ›å»ºå¼•æ“
engine = ADSEngine(verbose=True)

# 2. è¿æ¥
engine.connect(
    workspace_path="D:/Desktop/test_wrk",
    library_name="test_lib",
    design_name="test"
)

# 3. ç”Ÿæˆç½‘è¡¨
netlist = engine.generate_netlist()

# 4. è§£æå˜é‡
variables = NetlistParser.parse_variables(netlist)

# 5. è¿è¡Œä»¿çœŸ
ds_path, results = engine.run_simulation(output_no=1)

# 6. ç»˜åˆ¶ç»“æœ
viz = ResultVisualizer(output_dir="./results/plots")
for block_name, df in results.items():
    viz.plot_from_dataframe(df, title=block_name)

# 7. æ¸…ç†
engine.close()
```

### å‚è€ƒ 4.py çš„æ•°æ®æå–

```python
# ä»¿çœŸç»“æœå·²ç»è¢«æå–ä¸º DataFrame
for block_name, df in results.items():
    # æå–é¢‘ç‡å’Œ S å‚æ•°
    freq = df['freq'].values / 1e6  # è½¬æ¢ä¸º MHz
    
    if 'S[2,1]' in df.columns:
        S21 = 20 * np.log10(abs(df['S[2,1]'].values))
        S11 = 20 * np.log10(abs(df['S[1,1]'].values))
        
        # ç»˜å›¾
        import matplotlib.pyplot as plt
        plt.figure()
        plt.plot(freq, S21, label='S21')
        plt.plot(freq, S11, label='S11')
        plt.xlabel('Frequency (MHz)')
        plt.ylabel('Magnitude (dB)')
        plt.legend()
        plt.grid()
        plt.savefig('s_params.png')
```

---

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°è®°å½•

### v2.0 (2026-02-02)
- âœ… ä¿®å¤å¯¼å…¥é¡ºåºé—®é¢˜ï¼ˆdds å…ˆäº datasetï¼‰
- âœ… æ”¹è¿›ä»¿çœŸæµç¨‹ï¼Œä½¿ç”¨ CircuitSimulator
- âœ… æ·»åŠ  DataFrame æ•°æ®æå–åŠŸèƒ½
- âœ… å‚è€ƒ 4.py æ”¹è¿›æ•°æ®å¤„ç†
- âœ… ç®€åŒ–é¡¹ç›®ç»“æ„ï¼Œåˆ é™¤æ— ç”¨æ–‡ä»¶
- âœ… åˆ›å»ºç»Ÿä¸€é¡¹ç›®æ–‡æ¡£

### v1.0
- åˆå§‹ç‰ˆæœ¬

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**é…ç½®é—®é¢˜**ï¼šè¿è¡Œ `check_config.py`  
**åŠŸèƒ½é—®é¢˜**ï¼šæŸ¥çœ‹æœ¬æ–‡æ¡£ç›¸å…³ç« èŠ‚  
**é”™è¯¯æ—¥å¿—**ï¼šæŸ¥çœ‹ç»ˆç«¯è¾“å‡ºå’Œ `sim_output_*/` ç›®å½•

---

**æ‰€æœ‰ä¿®æ”¹è¯·è®°å½•åœ¨æœ¬æ–‡æ¡£ï¼**
