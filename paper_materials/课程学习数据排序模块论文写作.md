# 基于课程学习的 SFT 数据排序策略

## 3.x 面向射频设计的课程学习数据组织

**动机与问题设定。**  
大语言模型的微调效果对训练样本的呈现顺序高度敏感。随机打乱策略（Random Shuffling）将难易差异悬殊的样本等概率混合呈现，导致模型在早期训练阶段即被高难度样本的梯度信号主导，形成局部最优并难以逃逸。受人类认知规律中"由浅入深"学习模式的启发——射频工程师通常先掌握低阶 Butterworth 低通滤波器的设计范式，再逐步习得高阶、宽带、多谐振结构的设计——本文提出一种**面向射频电路SFT数据的课程学习排序框架（Curriculum-Ordered SFT，CO-SFT）**，通过将训练样本按任务难度从易到难系统性排列，引导模型以渐进的方式建立从设计原理到复杂约束的层次化知识表示。

---

## 难度度量建模

设训练集 $\mathcal{D} = \{x_i\}_{i=1}^N$，其中每条样本 $x_i$ 为多轮对话格式的 JSONL 记录。本文为每条样本定义一个标量难度函数 $\mathcal{F}: x_i \mapsto d_i \in [0, 1]$，由以下四个正交因子的加权组合构成：

$$
d_i = w_1 \cdot \phi_{\text{order}}(x_i) + w_2 \cdot \phi_{\text{param}}(x_i) + w_3 \cdot \phi_{\text{conv}}(x_i) + w_4 \cdot \phi_{\text{type}}(x_i)
$$

其中 $w_1 = 0.25$，$w_2 = 0.20$，$w_3 = 0.35$，$w_4 = 0.20$，权重设计依据各维度对模型收敛困难程度的先验贡献比例确定。四个子评分函数分别定义如下。

### （1）网络阶数评分 $\phi_{\text{order}}$

滤波器阶数 $n$ 直接决定拓扑结构的复杂度与元件数量，更高阶数意味着更长的推理链与更多约束。本文将阶数归一化至 $[3, 9]$ 的线性区间：

$$
\phi_{\text{order}}(x_i) = \text{clip}\!\left(\frac{n - 3}{6},\; 0,\; 1\right)
$$

即3阶滤波器得分为0（最简单），9阶得分为1（最复杂）。

### （2）参数极端性评分 $\phi_{\text{param}}$

偏离工程实践标准参数（$R_0 = 50\,\Omega$，$f_c = 1\,\text{GHz}$，$L_a = 30\,\text{dB}$ 等）的样本要求模型具备更强的泛化推理能力。本文采用累加式量化方案：

$$
\phi_{\text{param}}(x_i) = \text{clip}\!\left(\,\sum_{k} \delta_k,\; 0,\; 1\right)
$$

其中 $\delta_k$ 为各参数异常项的指示得分：

| 异常条件 | 得分增量 $\delta_k$ |
|---|---|
| $R_0 \neq 50\,\Omega$ | $+0.20$ |
| $f_c > 3\,\text{GHz}$ 或 $f_c < 400\,\text{MHz}$ | $+0.20$ |
| 纹波 $r > 0.5\,\text{dB}$ 或 $r < 0.05\,\text{dB}$ | $+0.10$ |
| 阻带衰减 $L_a > 50\,\text{dB}$ 或 $L_a < 20\,\text{dB}$ | $+0.15$ |

### （3）对话复杂度评分 $\phi_{\text{conv}}$

本文将训练样本划分为三类，按复杂度递增排序：（i）**单轮指令型**，即一次用户请求对应一次完整设计输出；（ii）**多轮迭代型**，包含对话轮次 $T \geq 4$ 的设计-反馈-修正序列；（iii）**反思推理型**，包含显式的自我纠错与灵敏度分析推理链，要求模型具备元认知能力。正式定义为：

$$
\phi_{\text{conv}}(x_i) = \begin{cases}
0.0 & T < 4 \text{ 且无反思关键词} \\
0.5 & T \in [4, 6) \\
0.8 & T \geq 6 \\
\max(\cdot,\; 0.9) & \text{包含反思/纠错推理} \\
\max(\cdot,\; 0.85) & \text{包含灵敏度分析}
\end{cases}
$$

### （4）滤波器类型评分 $\phi_{\text{type}}$

设计复杂度在拓扑层面遵循：低通滤波器（LPF）$<$ 高通滤波器（HPF）$<$ 带通滤波器（BPF）的递进关系，因为带通设计需要同时满足双边带约束并涉及阻抗变换：

$$
\phi_{\text{type}}(x_i) = \begin{cases}
0.00 & \text{LPF} \\
0.15 & \text{HPF} \\
0.30 & \text{BPF}
\end{cases}
$$

---

## 课程排序算法

在完成全数据集难度评分后，本文执行全局升序排序，并在相邻难度分箱（桶大小为 $\lfloor N/20 \rfloor$）内施加轻度随机扰动，以避免过度有序引发的训练退化（Training Degeneration）。完整流程见算法1。

---

**算法 1**：CO-SFT 数据排序

> **输入：** 原始训练集 $\mathcal{D} = \{x_i\}_{i=1}^N$，桶大小 $B = \lfloor N/20 \rfloor$，随机种子 $s$  
> **输出：** 有序数据集 $\mathcal{D}^*$
>
> 1. **For** $i = 1$ **to** $N$ **do** $d_i \leftarrow \mathcal{F}(x_i)$
> 2. $\mathcal{D}' \leftarrow \text{Sort}(\mathcal{D},\; \text{key} = d_i,\; \text{ascending})$
> 3. **For** $j = 0$ **to** $\lfloor N/B \rfloor$ **do**  
>    &nbsp;&nbsp;&nbsp;&nbsp;$\mathcal{D}'[jB : (j+1)B] \leftarrow \text{Shuffle}(\mathcal{D}'[jB : (j+1)B],\; \text{seed} = s)$
> 4. $\mathcal{D}^* \leftarrow \mathcal{D}'$; **return** $\mathcal{D}^*$

---

## 课程学习阶段划分

经过排序后，训练集自然形成三个难度梯度阶段，分别对应不同的认知学习阶段：

| 难度区间 | 阶段名称 | 典型样本特征 |
|---|---|---|
| $d < 0.3$ | 基础范式学习 | 低阶LPF，标准参数，单轮对话 |
| $0.3 \leq d < 0.6$ | 参数泛化训练 | 中阶BPF，非标准参数，多轮迭代 |
| $d \geq 0.6$ | 复杂推理链习得 | 高阶结构，极端参数，反思纠错链 |

这三个阶段与人类射频工程师的知识获取路径高度吻合，使模型能够在稳固基础的前提下逐步习得高阶推理能力。

---

## 与已有工作的关联与区别

Bengio等人 [CITATION] 最早系统化提出课程学习理论，后续工作将其应用于神经机器翻译 [CITATION] 与代码生成 [CITATION]。本文的核心贡献在于：

**（i）提出面向物理约束设计任务的多因子难度度量框架。** 融合领域知识（阶数、参数极端性、拓扑类型）与语言特征（对话轮次、推理关键词），突破了NLP领域以句子长度或词频为主导的难度代理指标的局限性。该框架具有良好的可解释性，每个难度因子均与射频电路设计的物理复杂度直接对应。

**（ii）引入反思推理能力作为最高难度维度。** 将模型的自我校正行为显式建模为课程目标，这是射频智能体训练场景所特有的需求。现有工作通常将反思数据作为独立任务处理，本文将其统一纳入课程框架，使模型在具备扎实的单步设计能力之后，再逐步习得迭代纠错的元认知能力，有效避免了过早引入反思链导致的训练不稳定问题。
