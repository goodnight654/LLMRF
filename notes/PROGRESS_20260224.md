# 项目进度报告 — 2026-02-24

## 概览

本次会话完成了 **大规模 ADS 仿真数据生成**（LPF/HPF/BPF 三种滤波器类型），并将数据转换为 SFT 训练格式，注册到 LLaMA-Factory。

---

## 1. ADS 仿真数据集（基于真实仿真）

### 1.1 仿真配置
- **仿真引擎**: Keysight ADS 2025 Update1
- **滤波器类型**: Chebyshev
- **频带**: LPF (低通) / HPF (高通) / BPF (带通)
- **阶数范围**: 3-7 阶
- **并行度**: 20 个进程并行仿真
- **总耗时**: ~3 小时

### 1.2 仿真结果
| 频带 | 数量 | 说明 |
|------|------|------|
| LPF (低通) | 5,783 | 网格 + 随机规格 |
| HPF (高通) | 4,019 | 随机规格 |
| BPF (带通) | 3,998 | 随机规格 |
| **合计** | **13,800** | **全部仿真成功** |

### 1.3 数据路径
- 仿真结果: `G:\wenlong\ADS\filter_dataset_results_20260224\final_results.json`
- 各批次中间结果: `G:\wenlong\ADS\filter_dataset_results_20260224\results_batch_*.json`

---

## 2. SFT 训练数据集

### 2.1 主数据集（ADS 仿真 → SFT）
从 13,800 个仿真结果生成 47,822 个微调样本：

| 集合 | 样本数 | 文件 |
|------|--------|------|
| 训练集 | 43,057 | `filter_sft_zhmix/train.jsonl` (63.7 MB) |
| 验证集 | 2,387 | `filter_sft_zhmix/val.jsonl` (3.5 MB) |
| 测试集 | 2,378 | `filter_sft_zhmix/test.jsonl` (3.5 MB) |

样本类型分布:
- full (完整参数): 41,558
- followup_question (缺参追问): 1,886
- followup_resolve (多轮补全): 4,378

语言分布:
- 中文: 26,065 (54.5%)
- 中英混合: 13,385 (28.0%)
- 英文: 8,372 (17.5%)

### 2.2 辅助数据集
| 数据集 | 样本数 | 文件 | 说明 |
|--------|--------|------|------|
| 反思数据 (train) | 5,553 | `filter_reflection/train.jsonl` | 设计+仿真+反馈+改进 |
| 反思数据 (val) | 308 | `filter_reflection/val.jsonl` | 验证集 |
| 灵敏度分析 | 2,000 | `filter_reflection/sensitivity_train.jsonl` | 元件敏感度 |
| 逆向预测 | 2,000 | `filter_reflection/reverse_prediction_train.jsonl` | 正向预测+设计比较 |

### 2.3 LLaMA-Factory 注册
所有数据集已注册在 `LLaMA-Factory/data/dataset_info.json`:
- `filter_sft_zhmix_train` / `filter_sft_zhmix_val`
- `filter_reflection_train` / `filter_reflection_val`
- `filter_sensitivity_train`
- `filter_reverse_prediction_train`

---

## 3. 技术修复记录

### 3.1 HPF 原理图修复
- **问题**: ADS 原理图中 HPF 元件未正确连接（S21=-400 dB）
- **原因**: 串联/并联元件放置位置错误，导致主信号线断裂
- **修复**: 镜像 LPF 布局——C 作为串联元件放在主路径（位置 i*2），L 作为并联元件接地（位置 i*2+1.5）
- **验证**: S11=-4.74 dB, S21_min=-1.78 dB ✅

### 3.2 BPF 原理图修复
- **问题**: 并联 LC 谐振器在原理图中未连接到主信号线
- **原因**: 并联元件放置在无导线连接的位置
- **修复**: 使用顺序 k 元件放置法——串联 LC 占 4 格（L→线→C→线），并联 LC 先画水平导线再放 C/L 到地
- **验证**: S11=-3.46 dB, S21_min=-2.60 dB ✅

### 3.3 灵敏度分析 Bug 修复（前次会话）
- **问题**: 所有影响系数为 0.0
- **原因**: 响应计算使用闭式公式不依赖 gk 值
- **修复**: 改用 ABCD 矩阵梯形网络传递函数计算

---

## 4. 已修改文件清单

| 文件 | 变更 |
|------|------|
| `adsapi/batch_filter_simulation.py` | HPF/BPF 原理图创建、指标计算、CLI 参数 |
| `adsapi/batch_filter_simulation_parallel.py` | 同步 HPF/BPF 支持 |
| `adsapi/filter_designer.py` | HPF/BPF 设计方法、多频带规格生成 |
| `make_sft_dataset_zhmix.py` | INPUT_PATH 更新为新仿真结果 |
| `LLaMA-Factory/data/dataset_info.json` | 注册反思/灵敏度/逆向预测数据集 |

---

## 5. 下一步计划
1. **训练模型**: 使用 LLaMA-Factory QLoRA 微调 Qwen3-8B
   - 主数据集: `filter_sft_zhmix_train` (43,057 样本)
   - 辅助数据集: 反思 + 灵敏度 + 逆向预测 (9,553 样本)
2. **评估**: 在测试集上评估模型输出 JSON 的正确性和参数精度
3. **闭环验证**: 用模型输出参数重新跑 ADS 仿真，比较指标
